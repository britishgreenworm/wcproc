<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>WCPROC</title>

    <!-- Bootstrap -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>

  </head>
  <body>
    <h1>News Word Scraper</h1>

    <div id="input">
      <input id="filterText" type="text" />
      <input id="cmdFilter" type="button" onclick="queryCharts()" value="filter" />

    </div>

    <div  id="BBC" style="float:left; min-width: 310px; height: 900px; margin: 0 auto"></div>
    <div  id="CNN" style="float:left;  min-width: 310px; height: 900px; margin: 0 auto"></div>
    <div  id="CBS" style="float:left;  min-width: 310px; height: 900px; margin: 0 auto"></div>
    <div  id="FOX" style="float:left;  min-width: 310px; height: 900px; margin: 0 auto"></div>
    <div  id="NPR" style="float:left;  min-width: 310px; height: 900px; margin: 0 auto"></div>

    <script type="text/javascript">

    $("#filterText").keyup(function(event){
      if(event.keyCode == 13){
          $("#cmdFilter").click();
      }
    });


    queryCharts()


    function queryCharts()
    {
      loadFeedChart("BBC", document.getElementById('filterText').value);
      loadFeedChart("CBS", document.getElementById('filterText').value);
      loadFeedChart("CNN", document.getElementById('filterText').value);
      loadFeedChart("FOX", document.getElementById('filterText').value);
      loadFeedChart("NPR", document.getElementById('filterText').value);
    }

    function loadFeedChart(category, filter) {

      $.get("/api/getwords", {category: category, filter}, function (data) {

          data = JSON.parse(data);

          var names = [];
          var counts = [];

          for (var i = 0, len = data.length; i < len; i++) {
            if (data[i].name != "")
            {
              names.push(data[i].name);
              counts.push(data[i].count);
            }
          }

          $('#' + category).highcharts({
              title: { text:category},
              chart: {
                  type: 'bar'

              },
              xAxis: {
                  categories: names
              },
              plotOptions: {
                  bar: {
                      dataLabels: {
                          enabled: true
                      }
                  }
              },
              credits: {
                  enabled: false
              },
              series: [{
                  data: counts
              }]
          });
      });
    }


    </script>
  </body>
</html>
